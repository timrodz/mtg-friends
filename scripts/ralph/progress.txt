## Codebase Patterns
- subformat field is stored as a `:string` in Postgres, not a Postgres enum type. Adding new subformat values only requires updating `Ecto.Enum` in `tournament.ex`, not database migrations.
- Use `mix compile --warnings-as-errors` to typecheck
- The `create_regular_pairings/4` function routes to different pairing algorithms based on `tournament.subformat` (for rounds > 0)
- The `PlayerPairing` struct tracks `players_played_against` and `players_not_played_with` for opponent variety calculations
- Use `@spec` without `@doc` for private functions (Elixir discards `@doc` on private functions)

---

## 2026-01-24 - US-001
- What was implemented: Created migration file for round_robin subformat (documentation-only since subformat is stored as string)
- Files changed: `priv/repo/migrations/20260124000000_add_round_robin_to_subformat.exs`
- **Learnings for future iterations:**
  - The subformat field is stored as a string in Postgres, NOT as a Postgres enum type
  - Adding new enum values to Ecto.Enum does not require database migrations when the column type is string
  - Migration files can serve as documentation even when no actual schema change is needed

---

## 2026-01-24 - US-002
- What was implemented: Added `:round_robin` to the Ecto.Enum values for subformat in tournament schema, and updated the type spec
- Files changed: `lib/mtg_friends/tournaments/tournament.ex`
- **Learnings for future iterations:**
  - The tournament schema has a `@type t` spec that must be updated when adding new enum values
  - No migration needed since subformat is stored as a string (confirmed from US-001 learnings)

---

## 2026-01-24 - US-003, US-004, US-005
- What was implemented: 
  - `create_round_robin_pairings/3` - main round robin algorithm that ignores scores and prioritizes opponent variety
  - `build_round_robin_pods/3` - builds pods iteratively using optimal selection
  - `determine_pod_size/3` - determines pod size based on format (EDH: 3-4, Standard: 2)
  - `find_optimal_pod/4` - greedy selection of pod members minimizing repeat opponents
  - `select_pod_members/4` - recursive helper to build a pod with best candidates
  - Added `:round_robin` routing in `create_regular_pairings/4`
- Files changed: `lib/mtg_friends/pairings.ex`
- **Learnings for future iterations:**
  - The round robin algorithm uses `PlayerPairing` matrix from `build_player_pairing_matrix/2` just like Swiss
  - The algorithm greedily selects players with the most unplayed opponents first
  - Pod size is determined by format: EDH uses 3-4 players, Standard uses 2
  - All 240 existing tests still pass after adding the new algorithm

---
