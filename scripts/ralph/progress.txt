## Codebase Patterns
- subformat field is stored as a `:string` in Postgres, not a Postgres enum type. Adding new subformat values only requires updating `Ecto.Enum` in `tournament.ex`, not database migrations.
- Use `mix compile --warnings-as-errors` to typecheck
- The `create_regular_pairings/4` function routes to different pairing algorithms based on `tournament.subformat` (for rounds > 0)
- The `PlayerPairing` struct tracks `players_played_against` and `players_not_played_with` for opponent variety calculations
- Use `@spec` without `@doc` for private functions (Elixir discards `@doc` on private functions)
- `TournamentEditFormComponent` receives tournament with preloaded associations (game, participants) when editing
- When adding a new subformat, update both `render_subformat/1` and `render_subformat_description/1` in `lib/mtg_friends/tournament_renderer.ex`
- When building pods for algorithms, use remainder logic to distribute all participants evenly (e.g., 10 players with 3 pods = 4,3,3 not 3,3,3 with 1 leftover)
- Use `Pairings.list_pairings(tournament_id, round_id)` to get pairings for a round, `Pairings.update_pairings/3` to finalize results

---

## 2026-01-24 - US-001
- What was implemented: Created migration file for round_robin subformat (documentation-only since subformat is stored as string)
- Files changed: `priv/repo/migrations/20260124000000_add_round_robin_to_subformat.exs`
- **Learnings for future iterations:**
  - The subformat field is stored as a string in Postgres, NOT as a Postgres enum type
  - Adding new enum values to Ecto.Enum does not require database migrations when the column type is string
  - Migration files can serve as documentation even when no actual schema change is needed

---

## 2026-01-24 - US-002
- What was implemented: Added `:round_robin` to the Ecto.Enum values for subformat in tournament schema, and updated the type spec
- Files changed: `lib/mtg_friends/tournaments/tournament.ex`
- **Learnings for future iterations:**
  - The tournament schema has a `@type t` spec that must be updated when adding new enum values
  - No migration needed since subformat is stored as a string (confirmed from US-001 learnings)

---

## 2026-01-24 - US-003, US-004, US-005
- What was implemented: 
  - `create_round_robin_pairings/3` - main round robin algorithm that ignores scores and prioritizes opponent variety
  - `build_round_robin_pods/3` - builds pods iteratively using optimal selection
  - `determine_pod_size/3` - determines pod size based on format (EDH: 3-4, Standard: 2)
  - `find_optimal_pod/4` - greedy selection of pod members minimizing repeat opponents
  - `select_pod_members/4` - recursive helper to build a pod with best candidates
  - Added `:round_robin` routing in `create_regular_pairings/4`
- Files changed: `lib/mtg_friends/pairings.ex`
- **Learnings for future iterations:**
  - The round robin algorithm uses `PlayerPairing` matrix from `build_player_pairing_matrix/2` just like Swiss
  - The algorithm greedily selects players with the most unplayed opponents first
  - Pod size is determined by format: EDH uses 3-4 players, Standard uses 2
  - All 240 existing tests still pass after adding the new algorithm

---

## 2026-01-24 - US-006
- What was implemented: Added Round Robin option to tournament edit form subformat dropdown
  - Added "Round Robin (Maximize opponent variety for small tournaments)" option for EDH format
  - Dynamically shows "Recommended" label when tournament has <12 participants
  - Added `get_participant_count/1` helper to safely get participant count from tournament
- Files changed: `lib/mtg_friends_web/live/tournament_live/tournament_edit_form_component.ex`
- **Learnings for future iterations:**
  - The `tournament.participants` is preloaded when editing via the show page
  - For new tournaments, participant_count is nil since participants aren't created yet
  - The `get_subformat_options/3` now accepts participant_count as third argument for conditional labels

---

## 2026-01-24 - US-007
- What was implemented: Added Round Robin rendering support in tournament_renderer.ex
  - Added `:round_robin` case to `render_subformat/1` returning "Round Robin"
  - Added `:round_robin` case to `render_subformat_description/1` returning "Maximizes opponent variety for small tournaments (8-12 participants)"
- Files changed: `lib/mtg_friends/tournament_renderer.ex`
- **Learnings for future iterations:**
  - The `TournamentRenderer` module is in `lib/mtg_friends/` (not `lib/mtg_friends_web/`)
  - Both `render_subformat/1` and `render_subformat_description/1` need to be updated together for new subformats

---

## 2026-01-24 - US-008
- What was implemented: Comprehensive test suite for Round Robin pairing algorithm
  - Created `test/mtg_friends/round_robin_pairings_test.exs` with 14 tests
  - Test cases for 8, 9, 10, 11, and 12 participants
  - Tests verify opponent variety across multiple rounds
  - Edge case tests for dropped participants and mid-tournament drops
  - Fixed bug in `build_round_robin_pods/3` where remainder participants weren't distributed to pods
- Files changed:
  - `test/mtg_friends/round_robin_pairings_test.exs` (new file)
  - `lib/mtg_friends/pairings.ex` (bug fix for remainder distribution)
- **Learnings for future iterations:**
  - When testing multi-round scenarios, use `finalize_round_with_results/2` to properly set points via `update_pairings/3`
  - The `build_round_robin_pods` now distributes remainder participants across earlier pods (e.g., 10 players â†’ 4,3,3)
  - Tests should verify actual participant count in pairings, not just pairing structure
  - All 254 tests pass including the 14 new round robin tests

---
